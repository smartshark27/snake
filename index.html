<!DOCTYPE html>
<html>

<head>
    <title>Snakey</title>
    <meta name="viewport" content="user-scalable=no" />
</head>

<body>

    <svg id="canvas"
        style="touch-action: manipulation; position: absolute; left: 0; top: 0; font-family: 'Lucida Console', Monaco, monospace;"
        onload="handleLoad()" onresize="fitToScreen()" onclick="handleMouseClick(event)">
        <rect id="background" x="0" y="0" width="1" height="1" fill="white" />
        <text id="messageTextbox" dominant-baseline="middle" text-anchor="middle" x="50%" y="10%" font-size="16">Tap to
            start</text>
        <circle id="snakeHead" cx="50%" cy="50%" r="20" fill="green" />
    </svg>

    <script>
        const FPS = 24;
        const STEP_DISTANCE = 2;
        var velocityX, velocityY;
        var gameStarted = false;

        function handleLoad() {
            fitToScreen();
            const snakeHead = document.getElementById('snakeHead');
            snakeHead.setAttribute('cx', window.innerWidth / 2);
            snakeHead.setAttribute('cy', window.innerHeight / 2);
        }

        function fitToScreen() {
            const width = window.innerWidth;
            const height = window.innerHeight;

            const canvas = document.getElementById('canvas');
            canvas.setAttribute('width', width);
            canvas.setAttribute('height', height);

            const background = document.getElementById('background');
            background.setAttribute('width', width);
            background.setAttribute('height', height);
        }

        function handleMouseClick(event) {
            removeMessage();
            const clickX = event.clientX;
            const clickY = event.clientY;
            setVelocity(clickX, clickY);
            if (!gameStarted) {
                startGame();
            }
        }

        function removeMessage() {
            messageTextbox = document.getElementById("messageTextbox");
            messageTextbox.textContent = "";
        }

        function setVelocity(clickX, clickY) {
            const snakeHead = document.getElementById('snakeHead');
            const x = Number(snakeHead.getAttribute('cx'));
            const y = Number(snakeHead.getAttribute('cy'));
            const displacementX = x - clickX;
            const displacementY = y - clickY;
            const angle = Math.atan(displacementY / displacementX);
            const speedX = Math.cos(angle) * STEP_DISTANCE;
            const speedY = Math.sin(angle) * STEP_DISTANCE;
            velocityX = (clickX >= x) ? speedX : -speedX;
            velocityY = (clickX >= x) ? speedY : -speedY;
        }

        async function startGame() {
            gameStarted = true;
            while (gameStarted) {
                await sleep(Math.floor(1000 / FPS));
                moveSnake();
            }
        }

        function sleep(ms) {
            return new Promise(resolve => setTimeout(resolve, ms));
        }

        function moveSnake() {
            const head = document.getElementById("snakeHead");
            movePart(head);
        }

        function movePart(part) {
            const x = Number(part.getAttribute('cx'));
            const y = Number(part.getAttribute('cy'));
            const newX = x + velocityX;
            const newY = y + velocityY;

            part.setAttribute('cx', newX);
            part.setAttribute('cy', newY);
        }
    </script>

</body>

</html>